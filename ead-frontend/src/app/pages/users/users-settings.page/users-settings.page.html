<main
  class="relative min-h-screen font-sans overflow-hidden bg-slate-900 selection:bg-indigo-500/30 text-slate-100 antialiased">

  <app-background-effects />

  <!-- Topbar -->
  <app-header-page />

  <main class="relative z-10 max-w-7xl mx-auto p-6 lg:p-10">
    <h1 class="text-3xl font-bold tracking-tight text-white mb-2">User Settings</h1>
    <p class="text-slate-400 mb-8">Manage your profile information and security preferences.</p>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Left column: profile info -->
      <section class="lg:col-span-2 rounded-3xl bg-white/5 border border-white/10 shadow-2xl backdrop-blur-xl p-8">
        <h2 class="text-xl font-semibold text-white mb-6">Personal Information</h2>

        <form class="space-y-6" [formGroup]="userSettingsFormGroup">
          <div class="flex items-center gap-6 pb-6 border-b border-white/5">
            <div class="relative group">
              <div class="absolute inset-0 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 p-[1px]">
                <div class="w-full h-full rounded-full bg-slate-900 back"></div>
              </div>
              <img id="avatarPreview" class="relative h-20 w-20 rounded-full border-2 border-transparent object-cover"
                src="https://i.pravatar.cc/100?img=5" alt="avatar" />
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Profile photo</label>
              <div class="flex items-center gap-3">
                <label
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-500/10 border border-indigo-500/20 text-indigo-400 text-sm font-medium cursor-pointer hover:bg-indigo-500/20 transition-all">
                  <input id="avatarInput" type="file" accept="image/*" class="hidden" />
                  Upload new photo
                </label>
                <button type="button" class="text-sm text-slate-400 hover:text-white transition-colors">Remove</button>
              </div>
            </div>
          </div>

          @if (usersSelectors.userSettingState().loading) {
          <div class="grid place-items-center py-10">
            <svg class="h-8 w-8 animate-spin text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none"
              viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
              </path>
            </svg>
          </div>
          } @else {
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">Full name</label>
              <input app-input size="sm" formControlName="fullName" type="text" placeholder="Your name" />
            </div>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">Username</label>
              <input app-input size="sm" formControlName="username" type="text" placeholder="@username"
                class="disabled:bg-slate-800/50 disabled:text-slate-500 disabled:cursor-not-allowed" />
            </div>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">Phone number</label>
              <input app-input size="sm" formControlName="phoneNumber" type="text" placeholder="Your phone number" />
            </div>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">CPF</label>
              <input app-input size="sm" formControlName="cpf" type="text" placeholder="Your CPF" />
            </div>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">Email address</label>
              <input app-input size="sm" formControlName="email" type="email" placeholder="you@mail.com"
                class="disabled:bg-slate-800/50 disabled:text-slate-500 disabled:cursor-not-allowed" />
            </div>
          </div>

          <div class="flex items-center pt-6 mt-2 border-t border-white/5">
            <button app-button (click)="saveUserSettings()">Save changes</button>
          </div>
          }

        </form>
      </section>

      <!-- Right column: password + preferences -->
      <aside class="space-y-8">
        <section class="rounded-3xl bg-white/5 border border-white/10 shadow-2xl backdrop-blur-xl p-6">
          <h2 class="text-xl font-semibold text-white mb-6">Security</h2>
          <form class="space-y-4" action="#" method="POST">
            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">Current password</label>
              <input app-input type="password" size="sm" placeholder="Your Current Password" />
            </div>
            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">New password</label>
              <input app-input type="password" size="sm" placeholder="Your New Password" />
            </div>
            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-slate-300">Confirm new password</label>
              <input app-input type="password" size="sm" placeholder="Confirm New Password" />
            </div>
            <button app-button>Update password</button>
          </form>
        </section>

        <section class="rounded-3xl bg-white/5 border border-white/10 shadow-2xl backdrop-blur-xl p-6">
          <h2 class="text-xl font-semibold text-white mb-6">Preferences</h2>
          <div class="flex flex-col gap-2">
            <label
              class="flex items-center justify-between gap-4 rounded-xl bg-white/5 border border-white/5 p-4 cursor-pointer hover:bg-white/10 transition-colors">
              <span class="text-sm font-medium text-slate-200">Dark mode</span>
              <input type="checkbox" checked
                class="h-5 w-9 rounded-full appearance-none bg-slate-700 border border-white/10 checked:bg-indigo-500 relative transition-all cursor-pointer before:content-[''] before:absolute before:w-3 before:h-3 before:bg-white before:rounded-full before:top-1 before:left-1 checked:before:translate-x-4 before:transition-transform" />
            </label>
            <label
              class="flex items-center justify-between gap-4 rounded-xl bg-white/5 border border-white/5 p-4 cursor-pointer hover:bg-white/10 transition-colors">
              <span class="text-sm font-medium text-slate-200">Email notifications</span>
              <input type="checkbox"
                class="h-5 w-9 rounded-full appearance-none bg-slate-700 border border-white/10 checked:bg-indigo-500 relative transition-all cursor-pointer before:content-[''] before:absolute before:w-3 before:h-3 before:bg-white before:rounded-full before:top-1 before:left-1 checked:before:translate-x-4 before:transition-transform" />
            </label>
          </div>
        </section>

        <section
          class="flex flex-col gap-3 rounded-3xl bg-red-500/5 border border-red-500/10 shadow-xl backdrop-blur-xl p-6">
          <h2 class="text-xl font-semibold text-red-400">Danger zone</h2>
          <p class="text-sm text-slate-400 leading-relaxed">Once you delete your account, there is no going back. Please
            be certain.</p>
          <button app-button size="sm" color="danger">Delete account</button>
        </section>
      </aside>
    </div>
  </main>

  <script>
    // Avatar preview (no upload backend yet)
    const input = document.getElementById('avatarInput');
    const preview = document.getElementById('avatarPreview');
    if (input) {
      input.addEventListener('change', (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        preview.src = url;
      });
    }
  </script>
</main>